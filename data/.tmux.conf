# My config file for tmux

# which terminal to advetise as (helps in things like italics support)
#set -g default-terminal "rxvt-unicode-256color"
set -g default-terminal "xterm-256color"
if '[ -z "$DISPLAY" ]' 'set -g default-terminal "linux"'

# enable mouse support
set -g mouse on # since tmux 2.1
# for older tmux
#set -g mouse-select-pane on
#set -g mouse-select-window on
#set-window-option -g mode-mouse on

# scrollback buffer n lines
set -g history-limit 10000

# timeouts #####################################################################

# Set the esc/alt disambiguation timeout to 50ms. The default is half a second,
# which makes vim kind of painful
#set -sg escape-time 0
set -sg escape-time 50

# display statusbar messages for a longer time
set -g display-time 2000

# windows #####################################################################

# enable wm window titles
set -g set-titles on

# start window indexing at one instead of zero
set -g base-index 1

# listen for activity on all windows
set-window-option -g monitor-activity on

# constrain window size to the size of the smallest client displaying the window
set-window-option -g aggressive-resize on

# theme ########################################################################

# move status bar to the top
set -g status-position top

# the conf files here are generated via vim plugin tmuxline:
# for more details, see https://github.com/edkolev/tmuxline.vim
#
# when we have display, apply only the minimal config (shows only the window
# info since things like time will already be available from panels)
#
# `:TmuxlineSnapshot powerline powerline`
if '[ -z "$DISPLAY" ]' 'source ~/.tmux/tmuxline.full.conf'
# `:TmuxlineSnapshot powerline minimal`
if '[ -n "$DISPLAY" ]' 'source ~/.tmux/tmuxline.minimal.conf'

# not dependent on tmuxline
#source ~/.tmux/tmuxline.simple.conf

# copy mode selection
set-window-option -g mode-style fg=white,bg=black

# visually mark windows when a command is done
set-window-option -g window-status-activity-style blink

# key bindings ################################################################

# rxvt-tabbed like shortcuts
bind -n S-down new-window
bind -n S-right next
bind -n S-left prev
bind -n S-up last-window

# set the prefix to C-s (similar to screen)
unbind C-b
set -g prefix C-s
bind C-s send-prefix

# prefix, followed by Ctrl-d detaches the session
bind C-d detach

# split windows like vim
# vim's definition of a horizontal/vertical split is reversed from tmux's
bind s split-window -v
bind v split-window -h

# copy-paste ################################################################

# copy-mode: switch to vi-style controls
set-window-option -g mode-keys vi

# copy-mode: enter on prefix-escape
bind Escape copy-mode

# copy-mode: select on v, with r for rectangular selction
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# copy-mode: copy to system clipboard on y, as well as mouse drag and select
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -i -p && xsel -o -p | xsel -i -b"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xsel -i -p && xsel -o -p | xsel -i -b"

# paste to system clipboard on prefix-p
# by default, p is bound to previous window
unbind p
bind p run "xsel -o | tmux load-buffer - ; tmux paste-buffer"
